## YOLOPV2-OPENCV-TENSORRT实现交通目标检测、可驾驶区域分割、车道线检测三项视觉感知任务

### 1 模型介绍

本项目采用YOLOPV2模型进行目标检测、可驾驶区域分割、车道线检测三项视觉感知任务，相对于YOLOPV1来说以下三项优点：

- **更好**：提出了具有更好特征提取骨干的端到端感知网络，开发了更好的免费赠品袋来处理训练过程。

- **更快**：采用了更高效的 ELAN 结构来实现模型的合理内存分配。

- **更强：**所提模型具有稳定的网络设计，对各种场景的适应能力较强。

  模型与其他模型预测与帧率对比数据

  ![image-20240315144411507](https://cdn.jsdelivr.net/gh/1944195627wb/images@main/images/image-20240315144411507.png)

模型网络结构：

![](https://cdn.jsdelivr.net/gh/1944195627wb/images@main/images/yolopv2-480x640.png)

### 2 数据集

使用BDD100K作为数据集，数据集推动了视觉的进步，但现有的驾驶数据集在视觉内容和支持任务方面缺乏研究，以研究自动驾驶的多任务学习。研究人员通常只能在一个数据集上研究一小组问题，而现实世界的计算机视觉应用程序需要执行各种复杂的任务。驾驶视频数据集 BDD100K，包含 10 万个视频和 10 个任务，以评估图像识别算法在自动驾驶方面的令人兴奋的进展。该数据集具有地理、环境和天气的多样性，这对于训练不太可能对新条件感到惊讶的模型很有用。基于这个多样化的数据集，我们为异构多任务学习建立了一个基准，并研究了如何一起解决这些任务。我们的实验表明，现有模型需要特殊的训练策略来执行此类异构任务。 BDD100K 为未来在这个重要场所的学习打开了大门。

### 3 TENSORRT框架CUDA加速

尽管YOLOPV2模型能够很好的完成车道线、交通运输车辆、可驾驶区域的检测，但是由于需要部署于本地在Jetson nano上运行，因此需要满足较高的帧率，才能传输数据保证能够使小车正常运行。

项目前期使用的是Onnxruntime框架，模型为Onnx格式，python进行运行帧率只有5帧左右，因此在项目中期改用TENSORRT框架进行。

使用TENSORRT-8.5.2.2trtexec命令

`trtexec --onnx=./onnx_models/yolopv2-480x640.onnx \
		--saveEngine=./yolopv2-480x640.trt \
		--buildOnly \
		--int8`

将Onnx模型导出为trt模型，并且在此过程中将模型进行量化，将fp16数据类型转化为int8数据类型，大大提高了运算的效率，帧率提高至15帧左右，能够达到要求。

### 4 YOLOPV2-OPENCV-TENSORRT结合实现自动驾驶决策

用BDD100K数据集训练YOLOPV2模型，能够在白天、夜晚各种时间段，晴天，雾天，雨天，雪天各种天气准确的实现交通目标检测、可驾驶区域分割、车道线检测三项视觉感知任务，给自动驾驶的驾驶决策提供了保障。

整体决策代码使用OPENCV库，根据交通目标检测、可驾驶区域分割、车道线检测三项数据实现简单的决策，保证小车能够在一定的驾驶区域正常运行。

第一步，读取视频流，通过模型将交通目标、可驾驶区域、车道线区域检测出来。

第二步，将检测出的交通目标矩形框计算出面积，若交通目标矩形框的面积大小是否超过一定的面积阈值，进行判断是否需要停止行驶。

第三步，将车道线区域进行二值化，并进行腐蚀后得到轮廓防止一些干扰因素影响决策。

第四步，计算每个车道线的轮廓中心点，然后判断是否为极端情况（摄像头视角转角偏大），若为特殊情况，根据轮廓中心点坐标所在位置确定是左转还是右转。

第五步，找到每个轮廓的最顶部的点再根据阈值将某些相差较大的点过滤，再将所剩余的点横坐标和纵坐标取平均值，

第六步，将横坐标的平均值作为开始遍历的中心点，将纵坐标的平均值作为起始坐标，将每个轮廓的最低点对比得到的最高点作为截止坐标，然后根据二分法进行查找像素值为1的点从而拟合出最为准确的点，再将最为准确的点坐标作为数据传送给主控板。

### 5 检测结果

**交通目标检测结果**

![](https://cdn.jsdelivr.net/gh/1944195627wb/images@main/images/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202024-03-15%20171911.png)

**可驾驶区域分割**

![](https://cdn.jsdelivr.net/gh/1944195627wb/images@main/images/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202024-03-15%20172002.png)

**车道线检测**

![image-20240315172239393](https://cdn.jsdelivr.net/gh/1944195627wb/images@main/images/image-20240315172239393.png)

**白天和夜间可视化结果**

![image-20240315172257748](https://cdn.jsdelivr.net/gh/1944195627wb/images@main/images/image-20240315172257748.png)